<module title="Environnement de développement"
module-name="env"
>
<p>
Ci-dessous figurent différents outils, bibliothèques, extensions, ...,
concernant l'environnement de développement OCaml.
</p>

<section id="compilation" title="Compilation, liaison et construction">
<p>
La distribution d'OCaml fournit différents outils destinés à la compilation:
</p>
<dl>
<dt><icode>ocamlc</icode>, <icode>ocamlc.opt</icode></dt>
<dd>Compilateur vers du code-octet, en version code-octet ou en version native
<seemanual href="&lt;urldococamlc/&gt;"/></dd>

<dt><icode>ocamlopt</icode>, <icode>ocamlopt.opt</icode></dt>
<dd>Compilateur vers du code natif, en version code-octet ou en version native
<seemanual href="&lt;urldococamlopt/&gt;"/></dd>

<dt><icode>ocamlmklib</icode></dt>
<dd>Génération de bibliothèques contenant du code C et du code OCaml
<seemanual href="&lt;urldococamlopt/&gt;"/></dd>

<dt><icode>ocamlcp</icode></dt>
<dd>Frontal à ocamlc permettant d'instrumenter le code pour utiliser le profileur</dd>
</dl>
<p>
Les compilateurs OCaml fonctionnant en ligne de commande avec pléthore d'options,
ils sont largement compatibles avec les outils de construction (<em>build</em>)
"traditionnels" ou peuvent être appelés depuis des environnements intégrés.
Citons quelques possibilités parmi les plus répandues:
</p>
<dl>
<dt><ext-a href="&lt;urlocamlbuild/&gt;">OCamlbuild</ext-a></dt>
<dd>Un outil de compilation automatique de code OCaml, compilant récursivement les
fichiers selon l'ordre de dépendance découvert au fur et à mesure de la compilation.
Il est inclus dans la distribution OCaml.</dd>

<dt><ext-a href="https://bitbucket.org/mmottl/ocaml-makefile">OCamlMakefile</ext-a></dt>
<dd>Ce Makefile générique simplifie l'utilisation de Make pour OCaml.</dd>

<dt><ext-a href="http://projects.camlcity.org/projects/findlib.html">Findlib</ext-a> (OCamlfind)</dt>
<dd>Un gestionnaire d'installation de paquets pour OCaml. Il fournit une commande,
<icode>ocamlfind</icode>, pour compiler des fichiers OCaml, prenant en charge les
options nécessaires pour utiliser les paquets OCaml installés, ce qui simplifie
les commandes à indiquer par exemple dans les Makefiles.</dd>

<dt><ext-a href="http://omake.metaprl.org/index.html">OMake</ext-a></dt>
<dd>Un système semblable à Make et supportant d'autres langages qu'OCaml.
Il existe un <ext-a href="http://ocaml.org/learn/tutorials/compiling_with_omake.html">didacticiel
en anglais</ext-a>.</dd>

<dt><ext-a href="http://www.typerex.org/ocp-build.html">ocp-build</ext-a></dt>
<dd>Un autre système de construction permettant la description de paquets et
la compilation en parallèle.</dd>

<dt><icode>ocamldep</icode></dt>
<dd>Cet outil inclus dans la distribution OCaml analyse des fichiers sources
et génère leurs dépendances dans un format compris par l'outil Make. Cela permet
de ne pas avoir à indiquer explicitement les dépendances pour la compilation
séparée des modules à l'aide d'un Makefile.
<seemanual href="&lt;urlocamldep/&gt;"/>
</dd>
</dl>

</section>

<section id="toplevels" title="Interprètes">
<p>
L'interprète (<em>toplevel</em>) <icode>ocaml</icode>, inclus dans la distribution
évalue au vol le code OCaml qui lui est passé. Il peut interpréter des fichiers
passés sur la ligne de commande ou bien
se comporter comme un shell et interpréter les phrases que l'utilisateur saisit.
<seemanual href="&lt;urldoctoplevel/&gt;"/>
</p>
<p>
<ext-a href="&lt;urlutop/&gt;">UTop</ext-a> est un interprète amélioré, avec édition de ligne,
complétion, couleurs, ...
</p>
<p>
<ext-a href="&lt;urltryocaml/&gt;">Try OCaml</ext-a> est un interprète OCaml
compilé vers Javascript pour une exécution dans un navigateur web.
</p>
</section>

<section id="debug" title="Profilage et débogage">
<p>
La distribution OCaml fournit un débogueur, <icode>ocamldebug</icode>, permettant de suivre
l'exécution d'un programme pas à pas, de revenir en arrière, d'inspecter des valeurs,
mettre des points d'arrêt. Le programme doit être compilé en code-octet avec l'option
<icode>-g</icode>. <seemanual href="&lt;urlocamldebug/&gt;"/>
</p>
<p>
La distribution inclut également un profileur, <icode>ocamlprof</icode>, capable d'afficher
le nombre de passages à chaque point d'un programme compilé avec <icode>ocamlcp</icode>.
<seemanual href="&lt;urlocamlprof/&gt;"/>
</p>
<p>
On pourra également utiliser l'outil GNU <icode>gprof</icode> par exemple pour afficher le temps
passé dans chaque fonction.
</p>
<p>Signalons également <ext-a href="http://memprof.typerex.org/">OCaml Memory Profiler</ext-a>
permettant une visualisation des allocations par type de données.
</p>
</section>

<section id="preproc" title="Pré-processeurs, extensions">
<p>
Les outils de pre-processing permettent de définir des extensions de syntaxe
du langage afin par exemple de simplifier l'écriture de certaines constructions
répétitives, de générer automatiquement du code pour chaque déclaration
de type (comme des fonctions de lecture/écriture), ...
</p>
<p>Les compilateurs OCaml ont une option <icode>-pp</icode> permettant de spécifier une
commande de pré-traitement du fichier source à compiler.
</p>
<p>Historiquement, deux préprocesseurs ont fait partie de la distribution OCaml.
Un premier outil nommé Camlp4 était inclus dans la distribution OCaml. Il a
par la suite été remplacé par un <ext-a href="&lt;urlcamlp4/&gt;">nouveau Camlp4</ext-a>,
qui a lui aussi été sorti de la distribution OCaml et
est maintenant développé séparément, notamment pour pouvoir sortir des versions plus
souvent. Le premier Camlp4 s'appelle maintenant <ext-a href="&lt;urlcamlp5/&gt;">Camlp5</ext-a>
et est donc lui aussi développé séparément.
</p>
<since-version v="4.01.0">
<p>Les compilateurs OCaml ont également une option <icode>-ppx</icode>
permettant de spécifier un outil de modification de l'arbre de syntaxe
abstraite. Une commande ainsi spécifiée est donc appelée <em>après</em>
l'analyse syntaxique du fichier source et elle doit retourner un
arbre syntaxique. Ce mode de fonctionnement vise à faciliter le développement
d'extensions. De plus, il est possible de spécifier plusieurs commandes
(avec plusieurs options <icode>-ppx</icode>) de façon à combiner les
extensions (les pré-processeurs ainsi spécifiés sont appelés séquentiellement).
</p>
<p>
Des modules de la distribution OCaml offrent des facilités pour développer
de tels pré-processeurs
(<ext-a href="https://github.com/ocaml/ocaml/blob/trunk/parsing/ast_mapper.mli"><ml>Ast_mapper</ml></ext-a>,
<ext-a href="https://github.com/ocaml/ocaml/blob/trunk/parsing/ast_helper.mli"><ml>Ast_helper</ml></ext-a>). Le paquet <ext-a href="https://github.com/alainfrisch/ppx_tools">ppx_tools</ext-a> contient des outils et extensions ppx pour écrire des extensions ppx.
</p>
</since-version>
<since-version v="4.02.0">
<p>En plus de l'option <icode>-ppx</icode>, le langage a été enrichi par la
possibilité de définir des "points d'extension" (<em>extension points</em>
ou <em>extension nodes</em>) <seemanual href="&lt;urldococamlexts/&gt;"/>.
Il s'agit d'une syntaxe utilisable à peu près partout en lieu et place
d'une expression, d'un filtre, d'une définition de module, ... Il revient
aux pré-processeurs ppx de transformer ces points d'extensions en construction
OCaml "normales" (sinon le compilateur OCaml termine en erreur, aucune sémantique
n'étant associée à ces points d'extension).
On pourra lire <ext-a href="http://whitequark.org/blog/2014/04/16/a-guide-to-extension-points-in-ocaml/">ce billet (en anglais)</ext-a> pour un exemple complet.
</p>
</since-version>
</section>

<section id="doc" title="Documentation">
<p>
L'outil <ext-a href="&lt;urlocamldoc/&gt;"><icode>ocamldoc</icode></ext-a> (ou <icode>ocamldoc.opt</icode> pour la version en code natif)
inclus dans la distribution est l'équivalent de <icode>javadoc</icode> ou
<icode>doxygen</icode> pour OCaml.
Il permet de générer une documentation de référence en utilisant des commentaires formattés.
<seemanual href="&lt;urlocamldoc/&gt;"/>
</p>
<p>
Ces commentaires sont des commentaires OCaml habituels, sauf qu'ils commencent par
<icode>(**</icode> au lieu de <icode>(*</icode>. Ils se terminent comme les commentaires
normaux par <icode>*)</icode>.
Le principe général est de placer un commentaire spécial juste au-dessus ou en-dessous
de l'élément (valeur, type, module, ...) commenté.
</p>
<p>
OCamldoc permet de générer des documentations aux formats <latex>\LaTeX</latex>,
HTML, Texinfo, pages man.
Il est également possible de définir son propre générateur et d'ajouter des éléments
de syntaxe pour générer des documentations spécialisées.
</p>
</section>

<section id="edition" title="Edition de code">
<p>
Avec le temps, plusieurs solutions d'édition de code OCaml ont vu le jour:
</p>
<ul>
<li> le mode <b>Emacs</b> standard: la distribution OCaml fournit un mode Emacs offrant la coloration
syntaxique, l'indentation et l'accès aux commandes de compilation, l'affichage des annotations
de type, ...,</li>
<li><ext-a href="https://github.com/ocaml/tuareg/">Tuareg</ext-a>
est un autre mode Emacs,</li>
<li><ext-a href="http://www.lix.polytechnique.fr/~dbaelde/productions/omlet.html">OMLet</ext-a>
est un mode pour l'éditeur Vim,</li>
<li><ext-a href="http://www.typerex.org/">Typerex</ext-a>, une suite d'outils offrant des fonctionnalités
avancées (refactoring, navigation, ...) avec des commandes emacs,</li>
<li><ext-a href="http://www.typerex.org/ocaml-top.html">OCaml-top</ext-a>, un éditeur dédié
à l'apprentissage d'OCaml,</li>
<li><ext-a href="http://zoggy.github.com/chamo/">Chamo</ext-a>
est une sorte d'Emacs développé en OCaml,</li>
<li><ext-a href="http://ocamleditor.forge.ocamlcore.org/">OCaml editor</ext-a>
est un éditeur de code OCaml,</li>
<li><ext-a href="http://ocamldt.free.fr/">ODT</ext-a> est un ensemble de greffons
pour Eclipse,</li>
<li><ext-a href="http://try.ocamlpro.com">une application web</ext-a> pour essayer OCaml en ligne.</li>
</ul>
</section>

<section id="packages" title="Gestionnaires de paquets, installation">
<p>
Deux gestionnaires de paquets existent, permettant d'installer et recompiler automatiquement
des bibliothèques et leurs dépendances:
</p>
<dl>
<dt><ext-a href="https://opam.ocaml.org">OPAM</ext-a></dt>
<dd>C'est le gestionnaire de paquets ne plus utilisé. Il gère les dépendances
et les recompilations nécessaires lors de l'installation d'un nouveau paquet,
permet d'avoir plusieurs versions d'OCaml installées, ...</dd>
<dt><ext-a href="https://github.com/thelema/odb">Odb</ext-a>,</dt>
<dd>Un autre gestionnaire de paquets (non testé par l'auteur de ces lignes).</dd>
</dl>
</section>

<section id="parsing" title="Analyse syntaxique">
<p>
Comme <icode>yacc</icode> et <icode>lex</icode> pour C, les outils
<icode>ocamlyacc</icode> et <icode>ocamllex</icode>, inclus dans la distribution OCaml
sont des générateurs d'analyseurs respectivement grammaticaux (<em>parsers</em>) et
lexicaux (<em>lexers</em>).
Le manuel OCaml donne un exemple concret de leur utilisation.
<seemanual href="&lt;urlocamlyacc/&gt;"/>
</p>
<p>
Il existe d'autres outils d'analyse syntaxique:
</p>
<dl>
<dt><ext-a href="http://cristal.inria.fr/~fpottier/menhir/">Menhir</ext-a></dt>
<dd>Un générateur d'analyseurs grammaticaux comme <icode>ocamlyacc</icode>
(avec une syntaxe similaire) avec des fonctionnalités supplémentaires
(règles paramétrées, conflits mieux expliqués, possibilité de séparer
les spécifications en plusieurs fichiers pour introduire de la modularité, ...).</dd>

<dt><ext-a href="https://github.com/alainfrisch/sedlex">Sedlex</ext-a></dt>
<dd>Un générateur d'analyseurs lexicaux (comme <icode>ocamllex</icode>) supportant
l'Unicode.</dd>

<dt></dt>
<dd></dd>

<dt></dt>
<dd></dd>
</dl>
</section>


<section id="links" title="Quelques liens">
<p>
On pourra rechercher d'autres outils et bibliothèques ailleurs:
</p>
<dl>
<dt><ext-a href="https://github.com/rizo/awesome-ocaml">Awesome OCaml</ext-a></dt>
<dd>Cette page liste des ressources (outils, bibliothèques, documentatins, ...) par domaine.</dd>

<dt><ext-a href="http://opam.ocaml.org/packages/">Opam packages</ext-a></dt>
<dd>La liste des paquets disponibles dans Opam, avec un moteur de recherche.</dd>

<dt><ext-a href="La bosse Caml (non maintenue)">la bosse Caml (non maintenue)</ext-a></dt>
<dd>Une ancienne base de logiciels et bibliothèques OCaml, classés par domaine.</dd>
</dl>

<p>
Il n'y a pas de manière unique d'organiser le développement d'un logiciel
en OCaml. Chacun est libre d'organiser ses développéments avec les outils
de son choix, l'arborescence de fichiers qui lui convient, etc.
</p>
<p>On liste ici quelques lectures dont chacun pourra s'inspirer:</p>
<ul>
<li><ext-a href="http://caml.inria.fr/resources/doc/guides/guidelines.fr.html">Des conseils de style</ext-a>,</li>
<li>[anglais] <ext-a href="http://stackoverflow.com/questions/19350590/designing-large-projects-in-ocaml/19355173#19355173">Une réponse sur la mise en place de gros projets en OCaml</ext-a>,</li>
</ul>

</section>

</module>